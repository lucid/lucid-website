<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>doh.robot Spinner Test</title>

		<style>
			@import "../../../../util/doh/robot/robot.css";
		</style>

		<!-- required: dojo.js -->
		<script type="text/javascript" src="../../../../dojo/dojo.js"
			djConfig="isDebug: true, parseOnLoad: true"></script>

		<script type="text/javascript">
			dojo.require("dijit.dijit"); // optimize: load dijit layer
			dojo.require("dijit.robotx");

			dojo.addOnLoad(function(){
				var spin1;
				var spin2;
				var spin3;
				var delta=1; // redefine with doh.robot.mouseWheelSize when it is available
				doh.robot.initRobot('../test_Spinner.html');
				doh.register("dijit.form.Spinner",{
					name: "spinner0",
					timeout: 15000,
					setUp:function(){
						spin1=dijit.byId('integerspinner1');
						spin2=dijit.byId('integerspinner2');
						spin3=dijit.byId('realspinner1');
						spin1.attr('value', 900);
					},
					runTest: function(){
						// test typematic
						var d=new doh.Deferred();
						doh.robot.mouseMove(80, 175, 1083, true);
						doh.robot.mouseMoveAt(spin1.domNode, 663, 100, 54, 3);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.keyDown(dojo.keys.DOWN_ARROW, 30);
						doh.robot.keyUp(dojo.keys.DOWN_ARROW, 11000);
						doh.robot.sequence(function(){
							if(spin1.attr('value')<=800){
								d.callback(true);
							}else{
								d.errback(new Error('Error in typematic test. Expected <=800, got '+spin1.attr('value')));
							}
						}, 1000);
						return d;
					}
				});

				doh.register("dijit.form.Spinner",
				{
					name:"spinner1",
					timeout:5500,
					setUp:function(){
						spin1.attr('value', 900);
					},
					runTest:function(){
						// get the mouse's delta
						// note that Spinner spins backwards!
						delta=-doh.robot.mouseWheelSize;
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin1.domNode, 1000);
						doh.robot.mouseClick({left:true}, 500);
						// wheel up 10 times
						// this should increase the value by 10
						// takes 100ms/click
						doh.robot.mouseWheel(-10, 1000, 1000);
						doh.robot.sequence(function(){
							var v=spin1.attr('value');
							if(v==(900+10*delta)){
								d.callback(true);
							}else{
								d.errback(new Error("spinner 1: wrong value, expected "+(900+10*delta)+", got "+spin1.attr('value')));							}
						}, 1000);
						return d;
					}
				});

				doh.register("dijit.form.Spinner",
				{
					name:"spinner2",
					timeout:5500,
					setUp:function(){
						spin2.attr('value', 1000);
					},
					runTest:function(){
						// test custom delta with mouse wheel
						// it should increment 10 per mouse wheel
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin2.domNode, 1000);
						doh.robot.mouseClick({left:true}, 500);
						// wheel down 9 times
						// this should decrease the value by 90
						// takes 100ms/click
						doh.robot.mouseWheel(9, 1000, 1000);
						doh.robot.sequence(function(){
							if(spin2.attr('value')==(1000-90*delta)){
								d.callback(true);
							}else{
								d.errback(new Error("spinner 2: wrong value, expected "+(1000-90*delta)+", got "+spin2.attr('value')));
							}
						}, 1000);
						return d;
					}
				});

				doh.register("dijit.form.Spinner",
				{
					name:"spinner3",
					timeout:5500,
					setUp:function(){
						spin3.attr('value', 1.0);
					},
					runTest:function(){
						// test real number spinner with mouse wheel
						// it should increment 0.1 per mouse wheel
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin3.domNode, 1000);
						doh.robot.mouseClick({left:true}, 500);
						// wheel up 10
						// this should increase the value by 1.0
						// takes 100ms/click
						doh.robot.mouseWheel(-10, 1000, 1000); 
						doh.robot.sequence(function(){
							if(spin3.attr('value')==(1.0+1.0*delta)){
								d.callback(true);
							}else{
								d.errback(new Error("spinner 3: wrong value, expected "+(1.0+1.0*delta)+", got "+spin3.attr('value')));
							}
						}, 1000);
						return d;
					}
				});
				doh.run();
			});
		</script>
	</head>
</html>
